{% extends 'base.html' %}

{% block content %}
<div class="row justify-content-center">
    <div class="col-md-8">
        <div class="card shadow">
            <div class="card-header bg-primary text-white">
                <h4 class="mb-0"><i class="fas fa-user-circle me-2"></i>My Profile</h4>
            </div>
            <div class="card-body p-4">
                <form method="post">
                    {% csrf_token %}

                    <div class="row mb-3">
                        <div class="col-md-6">
                            <label for="first_name" class="form-label">First Name</label>
                            <input type="text" class="form-control" id="first_name" name="first_name"
                                value="{{ user.first_name }}">
                        </div>
                        <div class="col-md-6">
                            <label for="last_name" class="form-label">Last Name</label>
                            <input type="text" class="form-control" id="last_name" name="last_name"
                                value="{{ user.last_name }}">
                        </div>
                    </div>

                    <div class="mb-3">
                        <label for="email" class="form-label">Email Address</label>
                        <input type="email" class="form-control" id="email" name="email" value="{{ user.email }}"
                            required>
                    </div>

                    <div class="mb-3">
                        <label class="form-label">Username</label>
                        <input type="text" class="form-control" value="{{ user.username }}" disabled>
                        <div class="form-text">Username cannot be changed.</div>
                    </div>

                    <hr>

                    <div class="d-flex justify-content-between align-items-center">
                        <a href="{% url 'change_password' %}" class="btn btn-outline-secondary">
                            <i class="fas fa-key me-2"></i>Change Password
                        </a>
                        <button type="submit" class="btn btn-primary">
                            <i class="fas fa-save me-2"></i>Save Changes
                        </button>
                    </div>
                </form>
            </div>
        </div>

        <div class="card shadow mt-4">
            <div class="card-header bg-success text-white">
                <h4 class="mb-0"><i class="fas fa-calendar-alt me-2"></i>Holiday Calendar</h4>
            </div>
            <div class="card-body">
                <div class="d-flex justify-content-between align-items-center mb-3">
                    <button class="btn btn-sm btn-outline-secondary" onclick="changeMonth(-1)"><i
                            class="fas fa-chevron-left"></i></button>
                    <h5 id="calendar-month-year" class="mb-0 fw-bold"></h5>
                    <button class="btn btn-sm btn-outline-secondary" onclick="changeMonth(1)"><i
                            class="fas fa-chevron-right"></i></button>
                </div>

                <div class="calendar-container">
                    <div class="calendar-header">
                        <div class="text-danger">Sun</div>
                        <div>Mon</div>
                        <div>Tue</div>
                        <div>Wed</div>
                        <div>Thu</div>
                        <div>Fri</div>
                        <div class="text-danger">Sat</div>
                    </div>
                    <div id="calendar-days" class="calendar-days">
                        <!-- JS GENERATED -->
                    </div>
                </div>

                <div class="mt-3 small text-muted">
                    <span class="d-inline-block rounded p-1 bg-danger text-white me-2">Weekend</span>
                    <span>Sat & Sun are Holidays</span>
                </div>
            </div>
        </div>
    </div>

    <style>
        .calendar-container {
            border: 1px solid #ddd;
            border-radius: 8px;
            overflow: hidden;
        }

        .calendar-header,
        .calendar-days {
            display: grid;
            grid-template-columns: repeat(7, 1fr);
            text-align: center;
        }

        .calendar-header div {
            background-color: #f8f9fa;
            padding: 10px;
            font-weight: bold;
            border-bottom: 1px solid #ddd;
        }

        /* Dark mode support for header */
        body.dark-mode .calendar-header div {
            background-color: #2d2d2d;
            border-bottom-color: #444;
            color: #e0e0e0;
        }

        .calendar-days div {
            padding: 15px;
            border-bottom: 1px solid #eee;
            border-right: 1px solid #eee;
            min-height: 50px;
            /* Consistent height */
        }

        body.dark-mode .calendar-days div {
            border-color: #444;
            color: #e0e0e0;
        }

        .calendar-days div:hover:not(.empty) {
            background-color: #f0f0f0;
            cursor: pointer;
        }

        body.dark-mode .calendar-days div:hover:not(.empty) {
            background-color: #3d3d3d;
        }

        .calendar-days .today {
            background-color: #e8f5e9;
            font-weight: bold;
            border: 2px solid #28a745;
        }

        body.dark-mode .calendar-days .today {
            background-color: #1b5e20;
            border-color: #66bb6a;
        }

        .calendar-days .holiday {
            background-color: #ffebee;
            color: #c62828;
        }

        body.dark-mode .calendar-days .holiday {
            background-color: #3e2723;
            /* Darker red/brown */
            color: #ef9a9a;
        }

        .calendar-days .empty {
            background-color: #f9f9f9;
            cursor: default;
        }

        body.dark-mode .calendar-days .empty {
            background-color: #252525;
        }
    </style>

    <script>
        let currentDate = new Date();

        function renderCalendar() {
            const monthYear = document.getElementById('calendar-month-year');
            const calendarDays = document.getElementById('calendar-days');

            calendarDays.innerHTML = '';

            const year = currentDate.getFullYear();
            const month = currentDate.getMonth(); // 0-11

            const monthNames = ["January", "February", "March", "April", "May", "June",
                "July", "August", "September", "October", "November", "December"
            ];

            monthYear.innerText = `${monthNames[month]} ${year}`;

            // First day of the month (0=Sun, 1=Mon...)
            const firstDay = new Date(year, month, 1).getDay();
            // Days in month
            const daysInMonth = new Date(year, month + 1, 0).getDate();

            // Add empty cells for previous month
            for (let i = 0; i < firstDay; i++) {
                const emptyDiv = document.createElement('div');
                emptyDiv.className = 'empty';
                calendarDays.appendChild(emptyDiv);
            }

            // Add days
            const today = new Date();

            for (let i = 1; i <= daysInMonth; i++) {
                const dayDiv = document.createElement('div');
                dayDiv.innerText = i;

                // Check day of week for this date to mark holiday
                const currentDayOfWeek = new Date(year, month, i).getDay();

                if (currentDayOfWeek === 0 || currentDayOfWeek === 6) {
                    dayDiv.classList.add('holiday');
                }

                // Mark Today
                if (i === today.getDate() && month === today.getMonth() && year === today.getFullYear()) {
                    dayDiv.classList.add('today');
                }

                calendarDays.appendChild(dayDiv);
            }
        }

        function changeMonth(step) {
            currentDate.setMonth(currentDate.getMonth() + step);
            renderCalendar();
        }

        document.addEventListener('DOMContentLoaded', renderCalendar);
    </script>
</div>
{% endblock %}